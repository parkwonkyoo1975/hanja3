<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸŒŸ ì´ˆë“± í•„ìˆ˜ í•œì 300</title>
    <script src="https://cdn.jsdelivr.net/npm/hanzi-writer@3.0.0/dist/hanzi-writer.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Jua&display=swap');
        :root { --primary: #4CAF50; --secondary: #FFD700; --bg: #F0F4F0; --point-blue: #2196F3; }
        body { font-family: 'Jua', sans-serif; background-color: var(--bg); margin: 0; padding: 0; color: #333; }
        header { background: white; padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 4px solid var(--secondary); position: sticky; top: 0; z-index: 100; }
        .logo { font-size: 1.8rem; color: var(--primary); cursor: pointer; }
        .nav-menu button { background: var(--primary); color: white; border: none; padding: 8px 15px; border-radius: 10px; cursor: pointer; font-family: 'Jua'; margin-left: 5px; }
        .page { display: none; padding: 20px; max-width: 800px; margin: auto; }
        .active { display: block; }
        .card { background: white; padding: 30px; border-radius: 25px; box-shadow: 0 10px 20px rgba(0,0,0,0.1); margin-bottom: 25px; text-align: center; }
        #login-page { text-align: center; padding-top: 100px; }
        .login-input { width: 80%; max-width: 300px; padding: 15px; font-size: 1.5rem; border: 2px solid #ddd; border-radius: 15px; font-family: 'Jua'; text-align: center; margin-bottom: 20px; }
        .section-title { border-left: 5px solid var(--primary); padding-left: 10px; margin-top: 30px; text-align: left; font-size: 1.3rem; }
        .info-label { font-size: 1.8rem; font-weight: bold; margin: 5px 0; }
        .breakdown-table { width: 100%; border-collapse: collapse; margin-top: 15px; background: #fff; border-radius: 15px; overflow: hidden; border: 1px solid #eee; }
        .breakdown-table td { border: 1px solid #eee; padding: 20px; text-align: center; }
        .hanja-unit { font-size: 3.5rem; color: var(--primary); font-weight: bold; width: 40%; }
        .meaning-unit { font-size: 1.8rem; color: #444; text-align: left; padding-left: 30px; }
        .step-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; background: #fff; padding: 10px 20px; border-radius: 50px; }
        .btn-step { background: var(--primary); color: white; border: none; padding: 8px 20px; border-radius: 20px; cursor: pointer; font-family: 'Jua'; }
        .writer-flex { display: flex; justify-content: center; gap: 20px; margin: 20px 0; flex-wrap: wrap; }
        .char-box { border: 2px solid #ddd; border-radius: 15px; background: white; padding: 10px; width: 140px; height: 140px; display: flex; align-items: center; justify-content: center; position: relative; }
        .quiz-option { display: block; width: 100%; padding: 15px; margin: 10px 0; background: white; border: 2px solid #eee; border-radius: 15px; font-family: 'Jua'; font-size: 1.2rem; cursor: pointer; }
        .btn-action { background: #4CAF50; color: white; border: none; padding: 12px 25px; border-radius: 15px; font-size: 1.1rem; cursor: pointer; font-family: 'Jua'; margin: 5px; }
        .progress-container { width: 100%; background-color: #eee; border-radius: 10px; margin-bottom: 10px; height: 8px; }
        .progress-fill { height: 100%; background-color: var(--point-blue); border-radius: 10px; width: 0%; transition: 0.3s; }
    </style>
</head>
<body>

<div id="login-page" class="page active">
    <div class="card">
        <h1 style="font-size: 2.5rem; margin-bottom: 30px;">ì´ë¦„ì„ ì…ë ¥í•˜ë©´ ì‹œì‘í•´ìš”!</h1>
        <input type="text" id="user-name-input" class="login-input" placeholder="ì´ë¦„ ì…ë ¥"><br>
        <button class="btn-action" style="font-size: 1.5rem; padding: 15px 40px;" onclick="handleLogin()">í•™ìŠµ ì‹œì‘í•˜ê¸°</button>
    </div>
</div>

<div id="main-content" style="display: none;">
    <header>
        <div class="logo" onclick="location.reload()">ğŸŒŸ ì´ˆë“± í•„ìˆ˜ í•œì 300</div>
        <div id="user-display"><span id="display-name" style="margin-right:10px; font-size:1.1rem; color:#666;"></span><span id="user-pts" style="background: var(--primary); color: white; padding: 5px 12px; border-radius: 10px;">0P</span></div>
        <div class="nav-menu">
            <button onclick="showPage('page1')">í•™ìŠµí•˜ê¸°</button>
            <button onclick="showPage('page2')">ì“°ê¸°ì—°ìŠµ</button>
            <button onclick="showPage('page3')">ë‚´ ë‹¨ì–´ì¥</button>
        </div>
    </header>

    <div id="page1" class="page">
        <div id="study-box">
            <div class="progress-container"><div id="main-progress" class="progress-fill"></div></div>
            <div class="step-bar">
                <button class="btn-step" onclick="changeWord(-1)">â—€ ì´ì „</button>
                <span id="progress-text">1 / 100</span>
                <button class="btn-step" onclick="changeWord(1)">ë‹¤ìŒ â–¶</button>
            </div>
            <div class="card">
                <h1 id="main-word" style="color:var(--point-blue); font-size: 4.5rem; margin: 0 0 10px;"></h1>
                <div id="main-eum" class="info-label" style="color: #FF5722;"></div>
                <div id="main-desc" class="info-label" style="color: #2196F3;"></div>
                <h3 class="section-title">â‘  í•œì ëœ»í’€ì´</h3><table class="breakdown-table"><tbody id="hanja-breakdown"></tbody></table>
                <h3 class="section-title">â‘¡ íšìˆœ ë”°ë¼ë³´ê¸°</h3><div class="writer-flex" id="writer-container"></div><button class="btn-action" style="background:#2196F3;" onclick="playSequence()">ë‹¤ì‹œ ë³´ê¸°</button>
                <h3 class="section-title">â‘¢ í€´ì¦ˆ í’€ê¸°</h3><div id="quiz-content"></div><br><button class="btn-action" style="background:#FF9800; width:100%;" onclick="saveToCollection()">ì˜¤ëŠ˜ì˜ ë‹¨ì–´ ì €ì¥! ğŸ’</button>
            </div>
        </div>
    </div>
    <div id="page2" class="page"><div class="card"><h2>âœï¸ ì§ì ‘ ì¨ë³´ê¸°</h2><div id="target-draw" class="char-box" style="width:240px; height:240px; margin: auto;"></div><p id="quiz-guide" style="font-size:1.5rem; color:var(--primary); margin: 20px 0;">ê¸€ìë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”.</p><div id="draw-buttons"></div></div></div>
    <div id="page3" class="page"><div class="card"><h2>ğŸ’ ë‚˜ì˜ ìˆ˜ì§‘ ë‹¨ì–´ì¥</h2><div id="collection-list" style="display:grid; grid-template-columns: 1fr 1fr; gap:15px;"></div></div></div>
</div>

<script>
    // [ë³´ì • ë¡œì§] íšìˆœ ì• ë‹ˆë©”ì´ì…˜ ìí˜• ë§¤í•‘
    const charMap = {
        'é„•': 'éƒ·', // ì‹œê³¨ í–¥ (ë°ì´í„° ë³´ì •)
        'ç”£': 'ç”£'  // ë‚³ì„ ì‚° (U+7523 ì‚¬ìš©)
    };

    const hanjaDic = {
        "éƒ½": "ë„ì ë„", "å¸‚": "ì €ì ì‹œ", "é¦–": "ë¨¸ë¦¬ ìˆ˜", "åœ°": "ë•… ì§€", "åŸŸ": "ì§€ê²½ ì—­", "å ´": "ë§ˆë‹¹ ì¥", "äº¤": "ì‚¬ê·ˆ êµ", "é€š": "í†µí•  í†µ", "å…¬": "ê³µë³€ë  ê³µ", "åœ’": "ë™ì‚° ì›",
        "ç”£": "ë‚³ì„ ì‚°", "æ¥­": "ì—… ì—…", "è¾²": "ë†ì‚¬ ë†", "æ‘": "ë§ˆì„ ì´Œ", "æ¼": "ê³ ê¸°ì¡ì„ ì–´", "é‡Œ": "ë§ˆì„ ë¦¬", "æ´": "ë§ˆì„ ë™", "åœ–": "ê·¸ë¦¼ ë„", "æ•…": "ì—°ê³  ê³ ", "ä½": "ì‚´ ì£¼", "æ°‘": "ë°±ì„± ë¯¼",
        "ç’°": "ê³ ë¦¬ í™˜", "å¢ƒ": "ì§€ê²½ ê²½", "é ˜": "ê±°ëŠë¦´ ë ¹", "åœŸ": "í™ í† ", "è¡—": "ê±°ë¦¬ ê°€", "ç‰©": "ë§Œë¬¼ ë¬¼", "è³ª": "ë°”íƒ• ì§ˆ", "ç‹€": "í˜•ìƒ ìƒ", "æ…‹": "ëª¨ìŠµ íƒœ", "æº«": "ë”°ëœ»í•  ì˜¨",
        "åº¦": "ë²•ë„ ë„", "é¢¨": "ë°”ëŒ í’", "é€Ÿ": "ë¹ ë¥¼ ì†", "å…‰": "ë¹› ê´‘", "ç·š": "ì¤„ ì„ ", "è¡¨": "ê²‰ í‘œ", "é¢": "ë‚¯ ë©´", "ç”Ÿ": "ë‚  ìƒ", "å‘½": "ëª©ìˆ¨ ëª…", "å‹•": "ì›€ì§ì¼ ë™",
        "æ¤": "ì‹¬ì„ ì‹", "èº«": "ëª¸ ì‹ ", "å¿ƒ": "ë§ˆìŒ ì‹¬", "æ°£": "ê¸°ìš´ ê¸°", "é«”": "ëª¸ ì²´", "æ˜Ÿ": "ë³„ ì„±", "åº§": "ìë¦¬ ì¢Œ", "æ—¥": "ë‚  ì¼", "å¤§": "í° ëŒ€", "æ°´": "ë¬¼ ìˆ˜",
        "åˆ†": "ë‚˜ëˆŒ ë¶„", "é": "ì§€ë‚  ê³¼", "å»": "ê°ˆ ê±°", "ç¾": "ë‚˜íƒ€ë‚  í˜„", "åœ¨": "ìˆì„ ì¬", "æœª": "ì•„ë‹ ë¯¸", "ä¾†": "ì˜¬ ë˜", "è¨ˆ": "ì…€ ê³„", "åŠƒ": "ê·¸ì„ íš", "æœŸ": "ê¸°ì•½í•  ê¸°",
        "é–“": "ì‚¬ì´ ê°„", "è¨˜": "ê¸°ë¡í•  ê¸°", "å¿µ": "ìƒê°í•  ë…", "æ™‚": "ë•Œ ì‹œ", "åˆ»": "ìƒˆê¸¸ ê°", "æ­£": "ë°”ë¥¼ ì •", "åˆ": "ë‚® ì˜¤", "æ˜¨": "ì–´ì œ ì‘", "å¹´": "í•´ ë…„", "æ˜": "ë°ì„ ëª…",
        "æ³¨": "ë¶€ì„ ì£¼", "æ„": "ëœ» ì˜", "å¾…": "ê¸°ë‹¤ë¦´ ëŒ€", "é…": "ë‚˜ëˆŒ ë°°", "å”": "ë„ìš¸ í˜‘", "åŠ›": "í˜ ë ¥", "å°Š": "ë†’ì„ ì¡´", "é‡": "ë¬´ê±°ìš¸ ì¤‘", "æ ¼": "ê²©ì‹ ê²©", "å¤±": "ìƒì„ ì‹¤",
        "æ•—": "íŒ¨í•  íŒ¨", "æ¶ˆ": "ì‚¬ë¼ì§ˆ ì†Œ", "ç«": "ë¶ˆ í™”", "å": "ì´ë¦„ ëª…", "ç¾©": "ì˜³ì„ ì˜", "æ„Ÿ": "ëŠë‚„ ê°", "è¬": "ì‚¬ë¡€í•  ì‚¬", "ç›´": "ê³§ì„ ì§", "æ›²": "êµ½ì„ ê³¡", "ä¸‰": "ì„ ì‚¼",
        "è§’": "ë¿” ê°", "å››": "ë„‰ ì‚¬", "åœ“": "ë‘¥ê¸€ ì›", "å½¢": "ëª¨ì–‘ í˜•", "ä¸­": "ê°€ìš´ë° ì¤‘", "åˆ": "í•©í•  í•©", "å·®": "ì–´ê¸‹ë‚  ì°¨", "ç•°": "ë‹¤ë¥¼ ì´", "é †": "ìˆœí•  ìˆœ", "åº": "ì°¨ë¡€ ì„œ",
        "ç§»": "ì˜®ê¸¸ ì´", "åœ": "ë¨¸ë¬´ë¥¼ ì •", "æ­¢": "ê·¸ì¹  ì§€", "å": "ëŒì´í‚¬ ë°˜", "å°": "ëŒ€ë‹µí•  ëŒ€", "å…±": "í•œê°€ì§€ ê³µ", "å€": "êµ¬ë¶„í•  êµ¬", "åˆ¥": "ë‚˜ëˆŒ ë³„", "ç‰¹": "íŠ¹ë³„í•  íŠ¹",
        "åŸº": "í„° ê¸°", "ç¤": "ì£¼ì¶§ëŒ ì´ˆ", "æº–": "ê°–ì¶œ ì¤€", "å‚™": "ê°–ì¶œ ë¹„", "å®Œ": "ì™„ì „í•  ì™„", "æˆ": "ì´ë£° ì„±", "å§‹": "ì²˜ìŒ ì‹œ", "ä½œ": "ì§€ì„ ì‘", "çµ‚": "ëë‚  ì¢…", "äº†": "ë§ˆì¹  ë£Œ",
        "ä½¿": "ë¶€ë¦´ ì‚¬", "ç”¨": "ì“¸ ìš©", "ç™¼": "í•„ ë°œ", "è®Š": "ë³€í•  ë³€", "åŒ–": "ë  í™”", "è¿½": "ì«“ì„ ì¶”", "åŠ ": "ë”í•  ê°€", "é™¤": "ëœ ì œ", "é¸": "ê°€ë¦´ ì„ ", "æ“‡": "ê°€ë¦´ íƒ",
        "æ±º": "ê²°ë‹¨í•  ê²°", "å®š": "ì •í•  ì •", "è¡Œ": "ë‹¤ë‹ í–‰", "éŸ³": "ì†Œë¦¬ ìŒ", "æ¨‚": "ë…¸ë˜ ì•…", "ç¾": "ì•„ë¦„ë‹¤ìš¸ ë¯¸", "è¡“": "ì¬ì£¼ ìˆ ", "æ´»": "ì‚´ í™œ", "æ­Œ": "ë…¸ë˜ ê°€", "è¬ ": "ë…¸ë˜ ìš”",
        "å‹": "ì´ê¸¸ ìŠ¹", "åˆ©": "ì´ë¡œìš¸ ë¦¬", "ç«¶": "ë‹¤íˆ´ ê²½", "æŠ€": "ì¬ì£¼ ê¸°", "æ‡‰": "ì‘í•  ì‘", "æ´": "ë„ìš¸ ì›", "é€€": "ë¬¼ëŸ¬ë‚  í‡´", "æ©": "ì€í˜œ ì€", "å¸«": "ìŠ¤ìŠ¹ ì‚¬", "åŒ": "í•œê°€ì§€ ë™",
        "åƒš": "ë²— ë£Œ", "è¦ª": "ì¹œí•  ì¹œ", "æ—": "ê²¨ë ˆ ì¡±", "å…ˆ": "ë¨¼ì € ì„ ", "ç¥–": "í• ì•„ë¹„ ì¡°", "å¥³": "ì—¬ì ë…€", "æ¯": "ìˆ¨ì‰´ ì‹", "åŠŸ": "ê³µ ê³µ", "å’Œ": "í™”í•  í™”", "ç¦": "í™”ëª©í•  ëª©",
        "æœ¬": "ê·¼ë³¸ ë³¸", "ä½": "ìë¦¬ ìœ„", "ç½®": "ë‘˜ ì¹˜", "çµ": "ë§ºì„ ê²°", "æœ«": "ë ë§"
    };

    const rawData = [
        "éƒ½å¸‚,ë„ì‹œ,ì‚¬ëŒì´ ë§ì´ ì‚¬ëŠ” ê³³", "é¦–éƒ½,ìˆ˜ë„,í•œ ë‚˜ë¼ì˜ ì¤‘ì‹¬ì§€", "åœ°åŸŸ,ì§€ì—­,ì¼ì •í•œ ë²”ìœ„ì˜ ë•…", "å¸‚å ´,ì‹œì¥,ë¬¼ê±´ì„ ì‚¬ê³ íŒŒëŠ” ê³³", "äº¤é€š,êµí†µ,ì˜¤ê³  ê°€ëŠ” ì¼", "å…¬åœ’,ê³µì›,ëª¨ë‘ê°€ ì‰¬ëŠ” ì •ì›", "ç”£æ¥­,ì‚°ì—…,ë¬¼ê±´ì„ ë§Œë“œëŠ” ì¼", "è¾²æ‘,ë†ì´Œ,ë†ì‚¬ë¥¼ ì§“ëŠ” ë§ˆì„", "æ¼æ‘,ì–´ì´Œ,ê³ ê¸° ì¡ëŠ” ë§ˆì„", "é‡Œæ´,ë¦¬ë™,ë§ˆì„ê³¼ ë™ë„¤",
        "åœ°åœ–,ì§€ë„,ë•…ì˜ ëª¨ì–‘ì„ ê·¸ë¦° ê·¸ë¦¼", "ä½æ°‘,ì£¼ë¯¼,ë§ˆì„ì— ì‚¬ëŠ” ì‚¬ëŒ", "ç’°å¢ƒ,í™˜ê²½,ë‘˜ëŸ¬ì‹¸ê³  ìˆëŠ” í˜•í¸", "é ˜åœŸ,ì˜í† ,í•œ ë‚˜ë¼ì˜ ë•…", "å¸‚è¡—,ì‹œê°€,ë„ì‹œì˜ ê±°ë¦¬", "ç‰©è³ª,ë¬¼ì§ˆ,ë¬¼ê±´ì„ ì´ë£¨ëŠ” ë³¸ë°”íƒ•", "ç‹€æ…‹,ìƒíƒœ,ì‚¬ë¬¼ì˜ ëª¨ìŠµ", "æº«åº¦,ì˜¨ë„,ë”°ëœ»í•˜ê³  ì°¨ê°€ìš´ ì •ë„", "é¢¨é€Ÿ,í’ì†,ë°”ëŒì˜ ì†ë„", "å…‰ç·š,ê´‘ì„ ,ë¹›ì˜ ì¤„ê¸°",
        "è¡¨é¢,í‘œë©´,ì‚¬ë¬¼ì˜ ê²‰ë©´", "ç”Ÿå‘½,ìƒëª…,ì‚´ì•„ ìˆëŠ” ëª©ìˆ¨", "å‹•ç‰©,ë™ë¬¼,ì›€ì§ì´ëŠ” ìƒë¬¼", "æ¤ç‰©,ì‹ë¬¼,ë¿Œë¦¬ ë°•ê³  ì‚¬ëŠ” ìƒë¬¼", "èº«å¿ƒ,ì‹ ì‹¬,ëª¸ê³¼ ë§ˆìŒ", "æ°£é«”,ê¸°ì²´,ê³µê¸° ê°™ì€ ìƒíƒœ", "æ˜Ÿåº§,ì„±ì¢Œ,ë³„ì˜ ìë¦¬", "æ—¥å…‰,ì¼ê´‘,í•´ì˜ ë¹›", "å¤§é¢¨,ëŒ€í’,í° ë°”ëŒ", "æ°´åˆ†,ìˆ˜ë¶„,ë¬¼ê¸°",
        "éå»,ê³¼ê±°,ì§€ë‚˜ê°„ ë•Œ", "ç¾åœ¨,í˜„ì¬,ì§€ê¸ˆ ìˆëŠ” ë•Œ", "æœªä¾†,ë¯¸ë˜,ì•„ì§ ì˜¤ì§€ ì•Šì€ ë•Œ", "è¨ˆåŠƒ,ê³„íš,ë¯¸ë¦¬ ì •í•œ ì¼", "æœŸé–“,ê¸°ê°„,ì–´ëŠ ë•Œë¶€í„° ì–´ëŠ ë•Œê¹Œì§€", "è¨˜å¿µ,ê¸°ë…,ìŠì§€ ì•Šê³  ê¸°ì–µí•¨", "æ™‚åˆ»,ì‹œê°,ì–´ëŠ í•œ ë•Œ", "æ­£åˆ,ì •ì˜¤,ë‚® 12ì‹œ", "æ˜¨å¹´,ì‘ë…„,ì§€ë‚œí•´", "æ˜å¹´,ëª…ë…„,ë‹¤ìŒ í•´",
        "æ³¨æ„,ì£¼ì˜,ë§ˆìŒì„ ì§‘ì¤‘í•¨", "æœŸå¾…,ê¸°ëŒ€,ë°”ë¼ê³  ê¸°ë‹¤ë¦¼", "å¿ƒé…,ì‹¬ë°°,ê±±ì •í•˜ê³  ì—¼ë ¤í•¨", "å”åŠ›,í˜‘ë ¥,í˜ì„ í•©ì¹¨", "å°Šé‡,ì¡´ì¤‘,ë†’ì—¬ ê·€í•˜ê²Œ ì—¬ê¹€", "é«”æ ¼,ì²´ê²©,ëª¸ì˜ í˜•ì²´", "å¤±æ•—,ì‹¤íŒ¨,ì¼ì„ ì˜ëª»í•¨", "æ¶ˆç«,ì†Œí™”,ë¶ˆì„ ë”", "åç¾©,ëª…ì˜,ë¬¸ì„œìƒì˜ ì´ë¦„", "æ„Ÿè¬,ê°ì‚¬,ê³ ë§ˆì›Œí•¨",
        "ç›´ç·š,ì§ì„ ,ê³§ì€ ì„ ", "æ›²ç·š,ê³¡ì„ ,êµ½ì€ ì„ ", "ä¸‰è§’,ì‚¼ê°,ì„¸ ê°œì˜ ë¿”", "å››è§’,ì‚¬ê°,ë„¤ ê°œì˜ ë¿”", "åœ“å½¢,ì›í˜•,ë‘¥ê·¼ ëª¨ì–‘", "ä¸­å¿ƒ,ì¤‘ì‹¬,í•œê°€ìš´ë°", "è§’åº¦,ê°ë„,ë¿”ì˜ ë²Œì–´ì§„ ì •ë„", "åˆè¨ˆ,í•©ê³„,ëª¨ë‘ í•©í•œ ìˆ˜", "å·®ç•°,ì°¨ì´,ì„œë¡œ ë‹¤ë¥¸ ì •ë„", "é †åº,ìˆœì„œ,ì°¨ë¡€",
        "ç§»å‹•,ì´ë™,ì˜®ê²¨ì„œ ì›€ì§ì„", "åœæ­¢,ì •ì§€,ë©ˆì¶¤", "é€šé,í†µê³¼,ì§€ë‚˜ì„œ ë‚˜ê°", "åå°,ë°˜ëŒ€,ê±°ê¾¸ë¡œ ë§ˆì£¼í•¨", "å…±é€š,ê³µí†µ,ì„œë¡œ ë˜‘ê°™ì´ ê°€ì§", "å€åˆ¥,êµ¬ë³„,ë‚˜ëˆ„ì–´ì„œ ë‹¤ë¥´ê²Œ í•¨", "ç‰¹åˆ¥,íŠ¹ë³„,ë³´í†µê³¼ ë‹¤ë¦„", "åŸºç¤,ê¸°ì´ˆ,ì‚¬ë¬¼ì˜ ê·¼ë³¸ í„°", "æº–å‚™,ì¤€ë¹„,ë¯¸ë¦¬ ê°–ì¶¤", "å®Œæˆ,ì™„ì„±,ë‹¤ ì´ë£¸",
        "å§‹ä½œ,ì‹œì‘,ì²˜ìŒìœ¼ë¡œ í•¨", "çµ‚äº†,ì¢…ë£Œ,ëë§ˆì¹¨", "ä½¿ç”¨,ì‚¬ìš©,ì‚¬ìš©í•¨", "ç™¼ç”Ÿ,ë°œìƒ,ì¼ì´ ìƒê²¨ë‚¨", "è®ŠåŒ–,ë³€í™”,ë°”ë€Œì–´ì„œ ë‹¬ë¼ì§", "è¿½åŠ ,ì¶”ê°€,ë‚˜ì¤‘ì— ë”í•¨", "é™¤å»,ì œê±°,ì—†ì•  ë²„ë¦¼", "é¸æ“‡,ì„ íƒ,ì—¬ëŸ¿ ì¤‘ ê°€ë¦¼", "æ±ºå®š,ê²°ì •,í™•ì‹¤íˆ ì •í•¨", "è¡Œå‹•,í–‰ë™,ëª¸ì„ ì›€ì§ì„",
        "éŸ³æ¨‚,ìŒì•…,ëª©ì†Œë¦¬ë‚˜ ì•…ê¸° ì†Œë¦¬", "ç¾è¡“,ë¯¸ìˆ ,ê·¸ë¦¼ì´ë‚˜ ì¡°ê°", "æ´»æ°£,í™œê¸°,ì‚´ì•„ ìˆëŠ” ê¸°ìš´", "æ­Œè¬ ,ê°€ìš”,ë…¸ë˜", "ä½œæ›²,ì‘ê³¡,ê³¡ì„ ì§€ìŒ", "å‹åˆ©,ìŠ¹ë¦¬,ì´ê¸°ê³  ì´ë¡œì›€", "ç«¶æŠ€,ê²½ê¸°,ì¬ì£¼ë¥¼ ë‹¤íˆ¼", "é¸æ‰‹,ì„ ìˆ˜,ë½‘íŒ ì‚¬ëŒ", "æ‡‰æ´,ì‘ì›,í˜ì„ ë„ì™€ì¤Œ", "é€€å ´,í‡´ì¥,ë°–ìœ¼ë¡œ ë¬¼ëŸ¬ë‚¨",
        "æ©å¸«,ì€ì‚¬,ê³ ë§ˆìš´ ìŠ¤ìŠ¹", "åŒåƒš,ë™ë£Œ,í•¨ê»˜ ì¼í•˜ëŠ” ë²—", "è¦ªæ—,ì¹œì¡±,ê°€ê¹Œìš´ ì¹œì²™", "å…ˆç¥–,ì„ ì¡°,ì¡°ìƒ", "å¥³æ¯,ì—¬ì‹,ë”¸", "æˆåŠŸ,ì„±ê³µ,ê³µì„ ì´ë£¸", "å’Œç¦,í™”ëª©,ì„œë¡œ ëœ»ì´ ë§ìŒ", "æœ¬å¿ƒ,ë³¸ì‹¬,ë³¸ë””ì˜ ë§ˆìŒ", "ä½ç½®,ìœ„ì¹˜,ì‚¬ë¬¼ì´ ìˆëŠ” ê³³", "çµæœ«,ê²°ë§,ì¼ì˜ ë"
    ];

    const hanjaList = rawData.map((item, idx) => {
        const [hanja, eum, desc] = item.split(",");
        return { id: idx + 1, word: hanja, eum: eum, desc: desc };
    });

    let currentUserName = ""; let userData = { points: 0, cards: [], lastIdx: 0 }; let currentIndex = 0; let writers = [];

    function handleLogin() {
        const nameInput = document.getElementById('user-name-input').value.trim();
        if (!nameInput) { alert("ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!"); return; }
        currentUserName = nameInput;
        const storageKey = 'hanjaMaster_V300_Final_Corrected_' + currentUserName;
        const saved = localStorage.getItem(storageKey);
        if(saved) userData = JSON.parse(saved);
        else userData = { points: 0, cards: [], lastIdx: 0 };
        document.getElementById('login-page').style.display = 'none';
        document.getElementById('main-content').style.display = 'block';
        document.getElementById('display-name').innerText = currentUserName + "ë‹˜ ë°˜ê°€ì›Œìš”!";
        showPage('page1'); updateHeader(); loadWord(userData.lastIdx || 0);
    }

    function loadWord(idx) {
        currentIndex = idx; userData.lastIdx = idx; const data = hanjaList[idx];
        document.getElementById('main-word').innerText = data.word;
        document.getElementById('main-eum').innerText = `ìŒ : ${data.eum}`;
        document.getElementById('main-desc').innerText = `ëœ» : ${data.desc}`;
        document.getElementById('progress-text').innerText = `${idx + 1} / 100`;
        document.getElementById('main-progress').style.width = (idx + 1) + "%";

        const breakdownTable = document.getElementById('hanja-breakdown');
        breakdownTable.innerHTML = '';
        [...data.word].forEach(char => {
            const meaning = hanjaDic[char] || "ëœ»í’€ì´ ì¤€ë¹„ì¤‘";
            breakdownTable.innerHTML += `<tr><td class="hanja-unit">${char}</td><td class="meaning-unit">${meaning}</td></tr>`;
        });

        const container = document.getElementById('writer-container');
        container.innerHTML = ''; writers = [];
        [...data.word].forEach((char, i) => {
            const box = document.createElement('div');
            box.className = 'char-box'; box.id = `char-box-${i}`;
            container.appendChild(box);
            let drawChar = charMap[char] || char; 
            const writer = HanziWriter.create(box.id, drawChar, { width: 120, height: 120, padding: 5, strokeColor: i % 2 === 0 ? '#4CAF50' : '#1A237E' });
            writers.push(writer);
        });
        setTimeout(() => playSequence(), 500);

        const qBox = document.getElementById('quiz-content');
        const wrongIdx = (idx + 13) % 100;
        const options = [data.desc, hanjaList[wrongIdx].desc].sort(() => Math.random() - 0.5);
        qBox.innerHTML = `<p style="font-size:1.4rem; margin-bottom:15px;"><b>${data.word}</b> ì˜ ì˜¬ë°”ë¥¸ ëœ»ì€?</p>`;
        options.forEach((opt, i) => { qBox.innerHTML += `<button class="quiz-option" onclick="checkQuiz(this, '${opt}' === '${data.desc}')">${i+1}. ${opt}</button>`; });

        const drawBtns = document.getElementById('draw-buttons');
        drawBtns.innerHTML = ''; [...data.word].forEach(char => { drawBtns.innerHTML += `<button class="btn-action" onclick="startDraw('${char}')">${char} ì“°ê¸°</button>`; });
        saveData();
    }

    async function playSequence() { for (let writer of writers) { writer.hideCharacter(); await new Promise(r => writer.animateCharacter({ onComplete: r })); } }
    function checkQuiz(btn, isCorrect) { if(isCorrect) { btn.style.background = "#c8e6c9"; userData.points += 10; updateHeader(); alert("ì •ë‹µì…ë‹ˆë‹¤! +10P âœ¨"); } else { btn.style.background = "#ffcdd2"; alert("ë‹¤ì‹œ í™•ì¸í•´ ë³´ì„¸ìš”! ğŸ¤”"); } }
    function startDraw(char) { showPage('page2'); document.getElementById('target-draw').innerHTML = ''; document.getElementById('quiz-guide').innerText = `"${char}"ë¥¼ ìˆœì„œëŒ€ë¡œ ì¨ë³´ì„¸ìš”!`; let drawChar = charMap[char] || char; const dw = HanziWriter.create('target-draw', drawChar, { width: 240, height: 240, showCharacter: false, showHintAfterMisses: 1 }); dw.quiz({ onComplete: () => { userData.points += 20; updateHeader(); alert("ì°¸ ì˜í–ˆì–´ìš”! +20P ğŸ‘"); }}); }
    function saveToCollection() { const word = hanjaList[currentIndex].word; if(!userData.cards.includes(word)) { userData.cards.push(word); userData.points += 50; updateHeader(); alert(`'${word}' ë‹¨ì–´ë¥¼ ì €ì¥í–ˆìŠµë‹ˆë‹¤! +50P ğŸ’`); } else alert("ì´ë¯¸ ì €ì¥ëœ ë‹¨ì–´ì…ë‹ˆë‹¤!"); }
    function changeWord(n) { const next = currentIndex + n; if(next >= 0 && next < 100) loadWord(next); }
    function updateHeader() { document.getElementById('user-pts').innerText = userData.points + "P"; saveData(); }
    function saveData() { if(currentUserName) { localStorage.setItem('hanjaMaster_V300_Final_Corrected_' + currentUserName, JSON.stringify(userData)); } }
    function showPage(pId) { document.querySelectorAll('.page').forEach(p => { if(p.id !== 'login-page') p.classList.remove('active'); }); document.getElementById(pId).classList.add('active'); if(pId === 'page3') renderCards(); }
    function renderCards() { const list = document.getElementById('collection-list'); list.innerHTML = ''; if(userData.cards.length === 0) { list.innerHTML = '<p style="grid-column: 1/3;">ìˆ˜ì§‘í•œ ë‹¨ì–´ê°€ ì—†ìŠµë‹ˆë‹¤.</p>'; return; } userData.cards.forEach(wordStr => { const data = hanjaList.find(i => i.word === wordStr); if(data) { list.innerHTML += `<div class="card" style="padding:15px; margin:0; border:2px solid var(--secondary);"><h3 style="margin:0; color:var(--point-blue);">${data.word}</h3><p style="margin:5px 0 0; font-size:0.9rem;">${data.desc}</p></div>`; } }); }
</script>
</body>
</html>